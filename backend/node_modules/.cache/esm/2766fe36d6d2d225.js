let StockListService,AlphaVantageController,formatResponse,formatDailyTimeSeries,CompanyOverviewService,IncomeStatementService,BalanceSheetService,CashFlowService,EarningsService,DailyTimeService;_d6d‍.x([["populateDailyTimeSeries",()=>populateDailyTimeSeries],["populateCompanyOverviews",()=>populateCompanyOverviews],["populateIncomeStatement",()=>populateIncomeStatement],["populateBalanceSheet",()=>populateBalanceSheet],["populateCashFlow",()=>populateCashFlow],["populateEarnings",()=>populateEarnings]]);_d6d‍.w("../database/StockList/service",[["default",["StockListService"],function(v){StockListService=v}]]);_d6d‍.w("../controller/AlphaVantageManualController",[["default",["AlphaVantageController"],function(v){AlphaVantageController=v}]]);_d6d‍.w("../router/ResearchRouter/function",[["formatResponse",["formatResponse"],function(v){formatResponse=v}],["formatDailyTimeSeries",["formatDailyTimeSeries"],function(v){formatDailyTimeSeries=v}]]);_d6d‍.w("../database/CompanyOverview/service",[["default",["CompanyOverviewService"],function(v){CompanyOverviewService=v}]]);_d6d‍.w("../database/IncomeStatement/service",[["default",["IncomeStatementService"],function(v){IncomeStatementService=v}]]);_d6d‍.w("../database/BalanceSheet/service",[["default",["BalanceSheetService"],function(v){BalanceSheetService=v}]]);_d6d‍.w("../database/CashFlow/service",[["default",["CashFlowService"],function(v){CashFlowService=v}]]);_d6d‍.w("../database/Earnings/service",[["default",["EarningsService"],function(v){EarningsService=v}]]);_d6d‍.w("../database/DailyTimeSeries/service",[["default",["DailyTimeService"],function(v){DailyTimeService=v}]]);









const APIKeys = ['113FTC7HN8SMKBCY', 'MLEHC065XYOTVN46', 'EA15V1XI1PFQGRE4', 'TV8A43YRMIT1299T', '45SB86LBVIJH82CI'];
let iteration = 1;

       async function populateDailyTimeSeries(){
    const stockList = await StockListService.findAll();

    for (const stock in stockList){
        const companyExist = await DailyTimeService.findBySymbol(stockList[stock].Symbol);
        if (!companyExist.length){
            iteration++;
            saveDailySeries(stockList[stock].Symbol, iteration)
        }
        
        // check if stock already exist in company overview
        if (!(iteration % 6)){
            iteration = 1;
            console.log("I am pausing")
            // Wait 13 second
            await new Promise(resolve => {
                setTimeout(resolve, 60000)
            })
        }   
    }
}

async function saveDailySeries(symbol, iterations){    
    // if it does not exist, get stock info from alphavantage
    try {
        const dailyTimeSeries = await AlphaVantageController.getDailyTimeSeries(symbol, APIKeys[iterations % 4]);
        _d6d‍.g.console.log("Symbol Saved: ", symbol)
        if (dailyTimeSeries["Meta Data"]){
            // If the response isn't empty, save it into the database
            const object = formatDailyTimeSeries(dailyTimeSeries)
            _d6d‍.g.console.log(object)
            await DailyTimeService.create(object);
        }
    } catch(err){
        if (!err.Note){
            const object = {
                Symbol: symbol,
                LastUpdated: new Date(),
            }
            await DailyTimeService.create(object);
        }
        _d6d‍.g.console.log(symbol, err)
    }
}

       async function populateCompanyOverviews(){
    // Find all stock lists
    const stockList = await StockListService.findAll();

    for (const stock in stockList){
        const companyExist = await CompanyOverviewService.findBySymbol(stockList[stock].Symbol);
        if (!companyExist.length){
            iteration++;
            saveCompanyOverview(stockList[stock].Symbol, iteration)
        }
        
        // check if stock already exist in company overview
        if (!(iteration % 6)){
            iteration = 1;
            console.log("I am pausing")
            // Wait 13 second
            await new Promise(resolve => {
                setTimeout(resolve, 60000)
            })
        }   
    }
}

async function saveCompanyOverview(symbol, iterations){    
    // if it does not exist, get stock info from alphavantage
    try {
        const companyOverview = await AlphaVantageController.getCompanyOverview(symbol, APIKeys[iterations % 4]);
        _d6d‍.g.console.log("Symbol Saved: ", symbol)
        if (companyOverview.Symbol){
            // If the response isn't empty, save it into the database
            const object = formatResponse(companyOverview)
            await CompanyOverviewService.create(object);
        }
    } catch(err){
        if (!err.Note){
            const object = {
                Symbol: symbol,
                LastUpdated: new Date(),
            }
            await CompanyOverviewService.create(object);
        }
        _d6d‍.g.console.log(symbol, err)
    }
}

       async function populateIncomeStatement(){
    // Find all stock lists
    const stockList = await StockListService.findAll();

    for (const stock in stockList){
        const companyExist = await IncomeStatementService.findBySymbol(stockList[stock].Symbol);
        if (!companyExist.length){
            iteration++;
            saveIncomeStatement(stockList[stock].Symbol, iteration)
        }
        
        // check if stock already exist in company overview
        if (!(iteration % 6)){
            iteration = 1;
            console.log("I am pausing")
            // Wait 13 second
            await new Promise(resolve => {
                setTimeout(resolve, 60000)
            })
        }   
    }
}

async function saveIncomeStatement(symbol, iterations){    
    // if it does not exist, get stock info from alphavantage
    try {
        const companyOverview = await AlphaVantageController.getIncomeStatement(symbol, APIKeys[iterations % 4]);
        _d6d‍.g.console.log("Symbol Saved: ", symbol)
        _d6d‍.g.console.log(companyOverview.annualReports[0])
        _d6d‍.g.console.log(companyOverview.symbol)
        if (companyOverview.symbol){

            // If the response isn't empty, save it into the database
            console.log("HELLO")
            const object = formatResponse(companyOverview)
            _d6d‍.g.console.log(object)
            await IncomeStatementService.create(object);
        }
    } catch(err){
        if (!err.Note){
            const object = {
                Symbol: symbol,
                LastUpdated: new Date(),
            }
            await IncomeStatementService.create(object);
        }
        _d6d‍.g.console.log(symbol, err)
    }
}

       async function populateBalanceSheet(){
    // Find all stock lists
    const stockList = await StockListService.findAll();

    for (const stock in stockList){
        const companyExist = await BalanceSheetService.findBySymbol(stockList[stock].Symbol);
        if (!companyExist.length){
            iteration++;
            saveBalanceSheet(stockList[stock].Symbol, iteration)
        }
        
        // check if stock already exist in company overview
        if (!(iteration % 6)){
            iteration = 1;
            console.log("I am pausing")
            // Wait 13 second
            await new Promise(resolve => {
                setTimeout(resolve, 60000)
            })
        }   
    }
}

async function saveBalanceSheet(symbol, iterations){    
    // if it does not exist, get stock info from alphavantage
    try {
        const companyOverview = await AlphaVantageController.getBalanceSheet(symbol, APIKeys[iterations % 4]);
        _d6d‍.g.console.log("Symbol Saved: ", symbol)
        if (companyOverview.Symbol){
            // If the response isn't empty, save it into the database
            const object = formatResponse(companyOverview)
            await BalanceSheetService.create(object);
        }
    } catch(err){
        if (!err.Note){
            const object = {
                Symbol: symbol,
                LastUpdated: new Date(),
            }
            await BalanceSheetService.create(object);
        }
        _d6d‍.g.console.log(symbol, err)
    }
}

       async function populateCashFlow(){
    // Find all stock lists
    const stockList = await StockListService.findAll();

    for (const stock in stockList){
        const companyExist = await CashFlowService.findBySymbol(stockList[stock].Symbol);
        if (!companyExist.length){
            iteration++;
            saveCashFlow(stockList[stock].Symbol, iteration)
        }
        
        // check if stock already exist in company overview
        if (!(iteration % 6)){
            iteration = 1;
            console.log("I am pausing")
            // Wait 13 second
            await new Promise(resolve => {
                setTimeout(resolve, 60000)
            })
        }   
    }
}

async function saveCashFlow(symbol, iterations){    
    // if it does not exist, get stock info from alphavantage
    try {
        const companyOverview = await AlphaVantageController.getCashFlow(symbol, APIKeys[iterations % 4]);
        _d6d‍.g.console.log("Symbol Saved: ", symbol)
        if (companyOverview.Symbol){
            // If the response isn't empty, save it into the database
            const object = formatResponse(companyOverview)
            await CashFlowService.create(object);
        }
    } catch(err){
        if (!err.Note){
            const object = {
                Symbol: symbol,
                LastUpdated: new Date(),
            }
            await CashFlowService.create(object);
        }
        _d6d‍.g.console.log(symbol, err)
    }
}

       async function populateEarnings(){
    // Find all stock lists
    const stockList = await StockListService.findAll();

    for (const stock in stockList){
        const companyExist = await EarningsService.findBySymbol(stockList[stock].Symbol);
        if (!companyExist.length){
            iteration++;
            saveEarnings(stockList[stock].Symbol, iteration)
        }
        
        // check if stock already exist in company overview
        if (!(iteration % 6)){
            iteration = 1;
            console.log("I am pausing")
            // Wait 13 second
            await new Promise(resolve => {
                setTimeout(resolve, 60000)
            })
        }   
    }
}

async function saveEarnings(symbol, iterations){    
    // if it does not exist, get stock info from alphavantage
    try {
        const companyOverview = await AlphaVantageController.getEarning(symbol, APIKeys[iterations % 4]);
        _d6d‍.g.console.log("Symbol Saved: ", symbol)
        if (companyOverview.Symbol){
            // If the response isn't empty, save it into the database
            const object = formatResponse(companyOverview)
            await EarningsService.create(object);
        }
    } catch(err){
        if (!err.Note){
            const object = {
                Symbol: symbol,
                LastUpdated: new Date(),
            }
            await EarningsService.create(object);
        }
        _d6d‍.g.console.log(symbol, err)
    }
}
