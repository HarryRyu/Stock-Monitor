let express,QuestradeController,parseISO,format,startOfDay,subDays;_638‍.x([["default",()=>_638‍.o]]);_638‍.w("express",[["default",["express"],function(v){express=v}]]);_638‍.w("../../controller/questradeController",[["default",["QuestradeController"],function(v){QuestradeController=v}]]);_638‍.w("date-fns/parseISO/index.js",[["default",["parseISO"],function(v){parseISO=v}]]);_638‍.w("date-fns/format/index.js",[["default",["format"],function(v){format=v}]]);_638‍.w("date-fns/startOfDay",[["default",["startOfDay"],function(v){startOfDay=v}]]);_638‍.w("date-fns/subDays",[["default",["subDays"],function(v){subDays=v}]]);






const router = express.Router();

// Retrieves historical data from the database
router.get('/:symbol', async (req, res, next) => {
    const symbol = req.params.symbol;
    try {
        // Retrieve data from the database baesd on stock symbol
        let candles = await QuestradeController().getHistoricalData(symbol, "2020-12-24T00:00:00-05:00", "2020-12-24T18:00:00-05:00", "TenMinutes")
        candles.data.candles.pop()
        res.send(candles.data.candles);;

    } catch(err){ res.send({ error: "Error has occured"}) }
});

router.get('/quote/:symbol', async (req, res, next) => {
    const symbol = req.params.symbol;
    try {
        const symbolId = await QuestradeController().getStockBySymbol([{Symbol: symbol}]);
        const {quotes} = await QuestradeController().getRealTimeQuotes(symbolId.symbols);

        const date = new Date();
        let currentTime = date.getTime()
        _638‍.g.console.log(currentTime)
        
        // currentTime = parseISO(currentTime, new Date())
        // console.log(currentTime)
        currentTime = subDays(currentTime, 1)
        const formattedDate = format(currentTime, "yyyy-MM-dd'T'HH:mm:ss.SSSX")
        const startDate = format(startOfDay(currentTime), "yyyy-MM-dd'T'HH:mm:ss.SSSX")
        
        _638‍.g.console.log(symbolId.symbols[0].symbolId, startDate, formattedDate)
        let recentData = await QuestradeController().getHistoricalData(symbolId.symbols[0].symbolId, startDate, "2021-01-05T011:08:32.931-05", "OneMinute")
        for (let item in recentData.candles){
            recentData.candles[item].start = recentData.candles[item].start.substring(11, 16)
        }
        res.send({quotes: quotes, recentData: recentData});

    } catch(err){ res.send({ error: "Error has occured"}) }
});


_638‍.d(router);